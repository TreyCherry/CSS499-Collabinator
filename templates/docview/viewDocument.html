{% extends "base.html" %}
{% macro topBox(bodytype) %}
    {% if check_state(g.stateint, bodytype) %}
        {% if bodytype == 2 %}
            {% set header = "Document Awaiting Approval" %}
        {% elif bodytype == 3 %}
            {% set header = "Select Reviewers for Document" %}
        {% endif %}
        {% if header %}
            <div class="top-box">
                <span id="unhide" class="hidden">{{ header }}</span>
                <div id="hide-box">
                    <h2>{{ header }}</h2>
                    {% if bodytype==2 %}
                        <span>Mark the document as approved for review?</span>
                        <i class="click-icon fa-solid fa-check big" onclick="setAction('approve')"></i>
                        <i class="click-icon fa-solid fa-xmark big" onclick="setAction('reject')"></i>
                    {% elif bodytype==3 %}
                        {% if reviewers %}
                            <form method="post" class="main-content wider">
                                <table class="main-content">
                                    <thead>
                                        <th>Name</th>
                                        <th>Role</th>
                                        <th>Add to Review?</th>
                                    </thead>
                                    <tbody>
                                        {% for reviewer in reviewers %}
                                            <tr>
                                                <td>{{ reviewer['first_name'] }} {{ reviewer['last_name'] }}</td>
                                                <td>{{ roles[reviewer['role_id'] | string] }}</td>
                                                <td>
                                                    <div class="checkbox">
                                                        <input type="checkbox" name="reviewerIDs" value="{{ reviewer['user_id'] }}">
                                                        <span class="checkmark" onclick="toggleCheck(this)"></span>
                                                    </div>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                                <button class="fix-size-button" onclick="setAction('markreview', this.form, false)">Submit</button>
                            </form>
                        {% endif %}
                    {% endif %}
                </div>
                <i class="min-icon fa-solid fa-angle-up big" onclick="hideBox(this)"></i>
            </div>
        {% endif %}
    {% endif %}
{% endmacro %}

{% block title %}View Document{% endblock %}

{% block header %}
    {{ topBox(docstate) }}
    <form method="post">
        <input type="hidden" id="docAction" name="action" value="none">
    </form>
{% endblock %}

{% block content %}
    <div class="relative-container">
        <div class="right-box">
            {% if docstate != 2 and check_state(g.stateint, 2) %}
            <i class="click-icon fa-regular fa-trash-can big" onclick="setAction('remove')"></i>
            {% endif %}
            {% if docstate != 2 and check_state(g.stateint, 7) %}
            <i class="click-icon fa-solid fa-arrow-up-from-bracket big" onclick="setAction('update')"></i>
            {% endif %}
            <i class="click-icon fa-regular fa-comment big"></i>
        </div>
        <iframe class="docview" src="{{ url_for('docs.viewer') }}?filename={{ filename }}"></iframe> {# iframe to display document #}
    </div>
    <div class="bottom-box">
        <i class="min-icon fa-solid fa-xmark big corner"></i>
        <h2>Comments</h2>
        <div class="comment-section">
            <div class="comment-box">

            </div>
            <div class="comment-container">
                <textarea class="comment-input"></textarea>
                <button>Comment</button>
            </div>
        </div>
    </div>
{% endblock %}

<script>
    {% block scripts %}
        function hideBox(node) {
            document.getElementById("hide-box").classList.toggle("hidden");
            document.getElementById("unhide").classList.toggle("hidden");
            node.classList.toggle("fa-angle-up");
            node.classList.toggle("fa-angle-down");
        }
        function setAction(action, otherform=null, doConfirm=true) {
            actionInput = document.getElementById("docAction");
            form = actionInput.form;
            actionInput.value = action;
            if (otherform != null) {
                form = otherform;
                form.appendChild(actionInput);
            }
            if (doConfirm && confirm('Are you sure you want to ' + action + ' this document?')) {
                actionInput.form.submit();
            }
        }
    {% endblock %}
</script>